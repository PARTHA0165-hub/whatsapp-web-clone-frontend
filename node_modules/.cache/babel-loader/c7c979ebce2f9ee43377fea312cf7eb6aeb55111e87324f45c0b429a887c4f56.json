{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import axios from\"axios\";import MessageBubble from\"./MessageBubble\";import SendMessageBox from\"./SendMessageBox\";import{io}from\"socket.io-client\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const socket=io(process.env.REACT_APP_API_URL);export default function ChatWindow(_ref){let{wa_id}=_ref;const[messages,setMessages]=useState([]);useEffect(()=>{if(wa_id){axios.get(\"\".concat(process.env.REACT_APP_API_URL,\"/api/chats/\").concat(wa_id)).then(res=>setMessages(res.data.messages||[])).catch(err=>console.error(err));}},[wa_id]);useEffect(()=>{socket.on(\"message_update\",msg=>{if(msg.wa_id===wa_id){setMessages(prev=>{const exists=prev.some(m=>m._id===msg._id);if(exists){return prev.map(m=>m._id===msg._id?msg:m);}return[...prev,msg];});}});return()=>{socket.off(\"message_update\");};},[wa_id]);const handleSend=text=>{axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/api/send\"),{wa_id,message:text,direction:\"outbound\"}).then(res=>{setMessages(prev=>[...prev,res.data.message]);});};if(!wa_id){return/*#__PURE__*/_jsx(\"div\",{className:\"flex-1 flex items-center justify-center text-gray-500\",children:\"Select a chat to view messages\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col flex-1\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-1 overflow-y-auto p-4 chat-bg\",children:messages.map(msg=>/*#__PURE__*/_jsx(MessageBubble,{msg:msg},msg._id))}),/*#__PURE__*/_jsx(SendMessageBox,{onSend:handleSend})]});}","map":{"version":3,"names":["React","useEffect","useState","axios","MessageBubble","SendMessageBox","io","jsx","_jsx","jsxs","_jsxs","socket","process","env","REACT_APP_API_URL","ChatWindow","_ref","wa_id","messages","setMessages","get","concat","then","res","data","catch","err","console","error","on","msg","prev","exists","some","m","_id","map","off","handleSend","text","post","message","direction","className","children","onSend"],"sources":["C:/Users/sarat/Documents/Projects/New/WhatsAppWebClone/frontend/src/components/ChatWindow.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport axios from \"axios\";\r\nimport MessageBubble from \"./MessageBubble\";\r\nimport SendMessageBox from \"./SendMessageBox\";\r\nimport { io } from \"socket.io-client\";\r\n\r\nconst socket = io(process.env.REACT_APP_API_URL);\r\n\r\nexport default function ChatWindow({ wa_id }) {\r\n  const [messages, setMessages] = useState([]);\r\n\r\n  useEffect(() => {\r\n    if (wa_id) {\r\n      axios.get(`${process.env.REACT_APP_API_URL}/api/chats/${wa_id}`)\r\n        .then(res => setMessages(res.data.messages || []))\r\n        .catch(err => console.error(err));\r\n    }\r\n  }, [wa_id]);\r\n\r\n  useEffect(() => {\r\n    socket.on(\"message_update\", (msg) => {\r\n      if (msg.wa_id === wa_id) {\r\n        setMessages(prev => {\r\n          const exists = prev.some(m => m._id === msg._id);\r\n          if (exists) {\r\n            return prev.map(m => m._id === msg._id ? msg : m);\r\n          }\r\n          return [...prev, msg];\r\n        });\r\n      }\r\n    });\r\n\r\n    return () => {\r\n      socket.off(\"message_update\");\r\n    };\r\n  }, [wa_id]);\r\n\r\n  const handleSend = (text) => {\r\n    axios.post(`${process.env.REACT_APP_API_URL}/api/send`, {\r\n      wa_id,\r\n      message: text,\r\n      direction: \"outbound\"\r\n    }).then(res => {\r\n      setMessages(prev => [...prev, res.data.message]);\r\n    });\r\n  };\r\n\r\n  if (!wa_id) {\r\n    return <div className=\"flex-1 flex items-center justify-center text-gray-500\">Select a chat to view messages</div>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex flex-col flex-1\">\r\n      <div className=\"flex-1 overflow-y-auto p-4 chat-bg\">\r\n        {messages.map(msg => (\r\n          <MessageBubble key={msg._id} msg={msg} />\r\n        ))}\r\n      </div>\r\n      <SendMessageBox onSend={handleSend} />\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}